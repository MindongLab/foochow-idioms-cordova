<html>

<head>

    <script src="https://code.createjs.com/easeljs-0.8.2.min.js"></script>

</head>



<body onload="init();">
    <canvas id="demoCanvas" width="640" height="640"></canvas>



    <script>
        function makeText(x,y, text, size){
            var font = 'bold '+size+"px Arial";
            var r = new createjs.Text(text,font,"blue");
            r.x=x;
            r.y=y;
            return r;
         }

         
         function drawLines(stage, startX, startY, limitX, limitY, fontsize ,padding, textArray){
             var height=limitY-startY,
                width=limitX-startX,
                charPerLine=Math.floor(width/fontsize),
                maxLineCount=Math.floor((height+padding)/(fontsize+padding));
                console.log(charPerLine,maxLineCount);
             var notAtLineStart = ['，','。','、','；','！','？','”']; //Punctuation marks that must wrap to the next line
             var heightUsed=0;
             var textPointer=0;
             var lines=[], thisLine=[];
             for (var i=0; i<textArray.length; ++i) {
                 if (thisLine.length>=charPerLine || 
                 (thisLine.length==charPerLine-1 && i<textArray.length-1
                  && notAtLineStart.indexOf(textArray[i+1])!=-1)) {
                     //new line
                     lines.push(thisLine);
                     thisLine=[];
                     if (lines.length>=maxLineCount) {
                         //overflow
                         lines[lines.length-1][charPerLine-1] =  lines[lines.length-1][charPerLine-2] = "…";
                         break;
                     }
                 } 

                 thisLine.push(textArray[i]);
             }
             if (thisLine.length>0 && lines.length<maxLineCount) {
                 lines.push(thisLine);
             }

             
             for (var i=0,j; i<lines.length; ++i){
                 for (j=0; j<lines[i].length; ++j) {
                     stage.addChild(makeText(startX+j*fontsize,startY+i*(fontsize+padding),lines[i][j],fontsize));
                 }
             }
             return lines.length*fontsize+(lines.length-1)*padding;
         }
         
        function init() {
    

            window.stage = new createjs.Stage("demoCanvas");

            var bg=  new createjs.Bitmap("images/share_bg.png");
            bg.x=0;
            bg.y=0;

            bg.image.addEventListener('load', function () {
                console.log('hihi');
                stage.update();
            });
            stage.addChild(bg);

     
            
            var endheight = drawLines(stage, 30,110,610,330, 60,20,'清明谷雨，寒死老鼠。字叫阿鲁巴的士鲁巴鲁巴鲁巴鲁巴鲁巴鲁巴鲁巴鲁巴鲁巴鲁巴鲁巴鲁巴大夫士大夫');
            drawLines(stage,40,endheight+130,600,530, 30,10,'【解说】清明谷雨，寒死老鼠老鼠。老鼠。老鼠。老鼠。老鼠。老鼠。老鼠。老鼠。老鼠。老鼠。老鼠。老鼠。老鼠。老鼠。老鼠。老鼠。。从前有座山山里有座庙庙里讴歌小和尚名字叫阿鲁巴的士大夫士大夫');
            stage.update();
        }
    </script>


</body>


</html>